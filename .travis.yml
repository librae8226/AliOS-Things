language: python
python:
  - '2.7'

sudo: false

env:
  # Toolchains
  ARM_TOOLCHAIN_URL="https://armkeil.blob.core.windows.net/developer/Files/downloads/gnu-rm/7-2017q4/gcc-arm-none-eabi-7-2017-q4-major-linux.tar.bz2"
  ESP8266_TOOLCHAIN_URL="http://arduino.esp8266.com/linux64-xtensa-lx106-elf.tar.gz"
  ESP32_TOOLCHAIN_URL="https://dl.espressif.com/dl/xtensa-esp32-elf-linux64-1.22.0-61-gab8375a-5.2.0.tar.gz"
  TOOLCHAIN_DIR="${HOME}/toolchain"
  ESP8266_BINDIR="${TOOLCHAIN_DIR}/xtensa-lx106-elf/bin"
  ESP32_BINDIR="${TOOLCHAIN_DIR}/xtensa-esp32-elf/bin"
  ARM_BINDIR="${TOOLCHAIN_DIR}/gcc-arm-none-eabi/bin"

  PATH="${PATH}:${ARM_BINDIR}:${ESP8266_BINDIR}:${ESP32_BINDIR}"

before_install:
  - echo '<before_install>'

install:
  - echo '<install>'
  - pwd
  - cd ${HOME}
  - mkdir -p ${TOOLCHAIN_DIR}

before_script:
  - echo '<before_script>'
  - cd ${TRAVIS_BUILD_DIR}
  - echo "export PATH=""${PATH}" >> ~/.bashrc
  - echo ${TRAVIS_COMMIT}
  - echo ${TRAVIS_PULL_REQUEST}
  - echo ${TRAVIS_JOB_NUMBER}

script:
  - echo '<script>'

after_success:
  - echo '<after_success>'
  - pip install oss2
  - find ./out -maxdepth 2 -type d -name libraries -o -name modules | xargs rm -r
  - tar caf aos.bins.${TRAVIS_JOB_NUMBER}.tar ./out
  - bzip2 aos.bins.${TRAVIS_JOB_NUMBER}.tar
  - ls -lh
  - echo 'test pull request'
